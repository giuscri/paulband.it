<!doctype html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paul Bandit</title>
  <link href="bower_components/normalize.css/normalize.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="bower_components/octicons/octicons/octicons.css" type="text/css" />
  <link rel="stylesheet" href="css/main.css" type="text/css" />
  <script src="bower_components/handlebars/handlebars.js"></script>
</head>
<body>
  <audio>
    <div class="errorlog">
      <p>
        <span class="warningcharacter">!</span>, seems like your machine
        is not hipster enough to support the player this page would like to use.
      </p>
      <p>
        Meh. Go home and use your brand new computer or trust us: this music is awesome!,
        you don't even need to listen, bro'.
      </p>
    </div>
  </audio>
  <div class="frontpage">
    <div class="title">
      <span>Paul Bandit</span>
    </div>
    <div class="licensenote">
      <p>
        All of the following songs are Creative Commons licensed (see below).
        Moreover, following a trend that we hope to become more standard,
        all of the songs are hashed and embedded into the Bitcoin
        blockchain, such to timestamp them, preventing the
        steal of intellectual property.
      </p>
    </div>
    <div class="songsbox">
      <div class="song">
        ...
      </div>
      <script class="songsbox-template" type="text/x-handlebars-template">
        {{#songs}}
          <div class="song" isplaying="false">
            <a href="#/{{filename}}">
              {{name}}
            </a>
            <div class="progressbar"></div>
          </div>
        {{/songs}}
      </script>
    </div>
    <div class="footer">
      <div class="referencetolicensetext">
        <a href="http://creativecommons.org/licenses/by-nc/4.0/legalcode">
          <span>Read the Creative Commons license</span>
        </a>
      </div>
      <div class="supportinfo">
        <p>
          If you love the songs&nbsp;-&nbsp;course you do&nbsp;-&nbsp;consider to support this amazing artist
          both by sharing his music and financially. How? ...we're still thinking about the easiest form of
          payment, so keep your wallet heavy up to that moment. Meanwhile, spread the world about
          this simple page (which we're going to use as a hub for the innumerous identities this artist has on the *net)
          and help Paul Bandit to get a critical mass of <del>fanz</del> suppporters.
        </p>
      </div>
      <div class="credits">
        <span><q>Less is more.</q>, 2015</span>
      </div>
  </div>
  <script type="text/javascript">
  "use strict";
  var paulband = {};
  paulband.it = {};
  paulband.it.start = function () {
      var player = document.querySelector("audio");
      var songsbox = document.querySelector("div.songsbox");
      [].slice.call(songsbox.children).forEach(function (songbox) {
          songbox.addEventListener("click", function (e) {
              var player = document.querySelector("audio");
              // Double clicking a song stops it permanently.
              if (songbox.getAttribute("isplaying") === "true") {
                  player.pause();
                  player.src = "";
                  var progressbar = songbox.children[1];
                  progressbar.style.width = "0%";
                  songbox.setAttribute("isplaying", "false");
              }
              // Else, clicking a song starts it.
              else if (songbox.getAttribute("isplaying") === "false") {
                  // Search, if any, the song which is playing.
                  [].slice.call(songsbox.children).forEach(function (sb) {
                      if (sb.getAttribute("isplaying") === "true") {
                          // then stop it and reset the progress bar.
                          var progressbar = sb.children[1];
                          progressbar.style.width = "0%";
                          sb.setAttribute("isplaying", "false");
                          player.pause();
                      }
                  });
                  // Hence!, fill the player with the brand new song.
                  var songname = songbox.children[0].hash.slice(2);
                  player.src = "static/" + songname;
                  player.play();
                  songbox.setAttribute("isplaying", "true");
              }
          });
      });
      // Every second, check for the progress of the song
      // which is playing and update the relative graphic
      // of the progress bar.
      setInterval(function () {
          var player = document.querySelector("audio");
          var progress = Math.floor(player.currentTime / player.duration * 100 * 100) / 100;
          var songplaying = null;
          var songsbox = document.querySelector("div.songsbox");
          [].slice.call(songsbox.children).forEach(function (sb) {
              if (sb.getAttribute("isplaying") === "true") {
                  songplaying = sb;
              }
          });
          if (songplaying) {
              var progressbar = songplaying.children[1];
              if (player.ended) {
                  progressbar.style.width = "0%";
                  songplaying.setAttribute("isplaying", "false");
              }
              else {
                  progressbar.style.width = progress + "%";
              }
          }
      }, 500);
  };
  window.onload = function () {
      var src = document.querySelector("script.songsbox-template").innerHTML;
      var res = Handlebars.compile(src);
      var xhr = new XMLHttpRequest();
      xhr.onload = function () {
          var songs = JSON.parse(this.responseText);
          document.querySelector("div.songsbox").innerHTML = res(songs);
          paulband.it.start();
      };
      xhr.open("GET", "songs.json", true);
      xhr.send();
  };
  </script>
  <script>
  // Google Analytics stuff... Forgive me!!
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-58169677-2', 'auto');
  ga('send', 'pageview');
  </script>
</body>
<!--
  Yes. We are hackerz. If you think I'm a shitty web developer, yes.
  You're right. Instead of complaining, send me a pull request!
    
      git@github.com:giuscri/paulband.it.git

  Thank you brother. :)

  Soundtrack used to hack on this simple project:
  
    + http://youtu.be/Qt97R7rISus
-->
</html>
<!-- vim: set et sw=2 ts=2: -->
